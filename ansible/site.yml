- hosts: nodes
  become: yes
  tasks:
    - include: roles/common/tasks/hosts.yml
- hosts: proxy
  roles:
    - proxy
- hosts: all
  become: yes
  roles:
    - common
  tasks:
    - include: roles/common/tasks/ssh.yml
    - include: roles/common/tasks/os.yml
    - include: roles/common/tasks/drives.yml
  handlers:
    - name: "update network settings"
      command: /sbin/ifup-local {{ network_interface }} 
- hosts: metrics
  become: yes
  roles:
    - influxdb
    - grafana
- hosts: all
  roles:
    - spark
    - hadoop
    - zookeeper
    - accumulo
- hosts: namenode
  tasks:
    - include: roles/hadoop/tasks/start-hdfs.yml
- hosts: resourcemanager
  tasks:
    - include: roles/hadoop/tasks/start-yarn.yml
    - include: roles/spark/tasks/start-spark-history.yml
- hosts: zookeepers
  tasks:
    - include: roles/zookeeper/tasks/start-zookeeper.yml
- hosts: accumulomaster
  tasks:
    - include: roles/accumulo/tasks/init-accumulo.yml
  handlers:
    - name: "initialize accumulo"
      command: "{{ accumulo_home }}/bin/accumulo init --clear-instance-name --instance-name {{ accumulo_instance }} --password {{ accumulo_password }}"
- hosts: accumulo
  tasks:
    - include: roles/accumulo/tasks/start-accumulo.yml
- hosts: fluo
  roles:
    - fluo
